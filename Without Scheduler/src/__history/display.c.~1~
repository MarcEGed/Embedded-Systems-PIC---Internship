#include <18F46K22.h>
#use delay(clock=16M)

#include "display.h"
#include "font.h"
#include "sh1106.h"

// Draw a single character
void draw_char(char c, unsigned int8 x, unsigned int8 y) {
    if (c < 'a' || c > 'z') return; // only lowercase letters supported

    const unsigned int8 *glyph = font5x7[c - 'a'];
    for (unsigned int8 i = 0; i < 5; i++) {
        for (unsigned int8 bit = 0; bit < 7; bit++) { // 7 for 5x7 font
            int pixel_on = (glyph[i] >> bit) & 0x01;
            sh1106_draw_pixel(x + i, y + bit, pixel_on);
        }
    }
}



// Draw a number
void draw_number(unsigned int16 num, unsigned int8 x, unsigned int8 y) {
    char buffer[6]; // Enough for 65535 + null
    int i = 0;

    // Handle 0 explicitly
    if (num == 0) {
        draw_char('0', x, y);
        return;
    }

    // Convert number to string manually
    while (num > 0 && i < sizeof(buffer) - 1) {
        buffer[i++] = '0' + (num % 10);
        num /= 10;
    }

    // Draw digits in reverse
    while (i > 0) {
        i--;
        draw_char(buffer[i], x, y);
        x += 6;
    }
}
